---
title: "swin transformer中相对位置编码解析"
date: 2025-01-02
permalink: /posts/2025/01/blog-post-1/
tags:
  - transformer
---

在论文中，作者发现相对位置编码的效果会更好一些。
![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/0.png)
![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/1.png)

代码的实现为：

```python
 # get pair-wise relative position index for each token inside the window
        coords_h = torch.arange(self.window_size[0])
        coords_w = torch.arange(self.window_size[1])
        coords = torch.stack(torch.meshgrid([coords_h, coords_w]))  # 2, Wh, Ww
        coords_flatten = torch.flatten(coords, 1)  # 2, Wh*Ww
        relative_coords = coords_flatten[:, :, None] - coords_flatten[:, None, :]  # 2, Wh*Ww, Wh*Ww
        relative_coords = relative_coords.permute(1, 2, 0).contiguous()  # Wh*Ww, Wh*Ww, 2
        relative_coords[:, :, 0] += self.window_size[0] - 1  # shift to start from 0
        relative_coords[:, :, 1] += self.window_size[1] - 1
        relative_coords[:, :, 0] *= 2 * self.window_size[1] - 1
        relative_position_index = relative_coords.sum(-1)  # Wh*Ww, Wh*Ww
        self.register_buffer("relative_position_index", relative_position_index)
```

在forward中的计算为：

```python
relative_position_bias = self.relative_position_bias_table[self.relative_position_index.view(-1)].view(
            self.window_size[0] * self.window_size[1], self.window_size[0] * self.window_size[1], -1)  # Wh*Ww,Wh*Ww,nH
        relative_position_bias = relative_position_bias.permute(2, 0, 1).contiguous()  # nH, Wh*Ww, Wh*Ww
        attn = attn + relative_position_bias.unsqueeze(0)
```

完整的class实现为：

```python
class WindowAttention(nn.Module):
    r""" Window based multi-head self attention (W-MSA) module with relative position bias.
    It supports both of shifted and non-shifted window.

    Args:
        dim (int): Number of input channels.
        window_size (tuple[int]): The height and width of the window.
        num_heads (int): Number of attention heads.
        qkv_bias (bool, optional):  If True, add a learnable bias to query, key, value. Default: True
        qk_scale (float | None, optional): Override default qk scale of head_dim ** -0.5 if set
        attn_drop (float, optional): Dropout ratio of attention weight. Default: 0.0
        proj_drop (float, optional): Dropout ratio of output. Default: 0.0
    """

    def __init__(self, dim, window_size, num_heads, qkv_bias=True, qk_scale=None, attn_drop=0., proj_drop=0.):

        super().__init__()
        self.dim = dim
        self.window_size = window_size  # Wh, Ww
        self.num_heads = num_heads
        head_dim = dim // num_heads
        self.scale = qk_scale or head_dim ** -0.5

        # define a parameter table of relative position bias
        self.relative_position_bias_table = nn.Parameter(
            torch.zeros((2 * window_size[0] - 1) * (2 * window_size[1] - 1), num_heads))  # 2*Wh-1 * 2*Ww-1, nH

        # get pair-wise relative position index for each token inside the window
        coords_h = torch.arange(self.window_size[0])
        coords_w = torch.arange(self.window_size[1])
        coords = torch.stack(torch.meshgrid([coords_h, coords_w]))  # 2, Wh, Ww
        coords_flatten = torch.flatten(coords, 1)  # 2, Wh*Ww
        relative_coords = coords_flatten[:, :, None] - coords_flatten[:, None, :]  # 2, Wh*Ww, Wh*Ww
        relative_coords = relative_coords.permute(1, 2, 0).contiguous()  # Wh*Ww, Wh*Ww, 2
        relative_coords[:, :, 0] += self.window_size[0] - 1  # shift to start from 0
        relative_coords[:, :, 1] += self.window_size[1] - 1
        relative_coords[:, :, 0] *= 2 * self.window_size[1] - 1
        relative_position_index = relative_coords.sum(-1)  # Wh*Ww, Wh*Ww
        self.register_buffer("relative_position_index", relative_position_index)

        self.qkv = nn.Linear(dim, dim * 3, bias=qkv_bias)
        self.attn_drop = nn.Dropout(attn_drop)
        self.proj = nn.Linear(dim, dim)
        self.proj_drop = nn.Dropout(proj_drop)

        trunc_normal_(self.relative_position_bias_table, std=.02)
        self.softmax = nn.Softmax(dim=-1)

    def forward(self, x, mask=None):
        """
        Args:
            x: input features with shape of (num_windows*B, N, C)
            mask: (0/-inf) mask with shape of (num_windows, Wh*Ww, Wh*Ww) or None
        """
        B_, N, C = x.shape
        qkv = self.qkv(x).reshape(B_, N, 3, self.num_heads, C // self.num_heads).permute(2, 0, 3, 1, 4)
        q, k, v = qkv[0], qkv[1], qkv[2]  # make torchscript happy (cannot use tensor as tuple)

        q = q * self.scale
        attn = (q @ k.transpose(-2, -1))

        relative_position_bias = self.relative_position_bias_table[self.relative_position_index.view(-1)].view(
            self.window_size[0] * self.window_size[1], self.window_size[0] * self.window_size[1], -1)  # Wh*Ww,Wh*Ww,nH
        relative_position_bias = relative_position_bias.permute(2, 0, 1).contiguous()  # nH, Wh*Ww, Wh*Ww
        attn = attn + relative_position_bias.unsqueeze(0)

        if mask is not None:
            nW = mask.shape[0]
            attn = attn.view(B_ // nW, nW, self.num_heads, N, N) + mask.unsqueeze(1).unsqueeze(0)
            attn = attn.view(-1, self.num_heads, N, N)
            attn = self.softmax(attn)
        else:
            attn = self.softmax(attn)

        attn = self.attn_drop(attn)

        x = (attn @ v).transpose(1, 2).reshape(B_, N, C)
        x = self.proj(x)
        x = self.proj_drop(x)
        return x

    def extra_repr(self) -> str:
        return f'dim={self.dim}, window_size={self.window_size}, num_heads={self.num_heads}'

    def flops(self, N):
        # calculate flops for 1 window with token length of N
        flops = 0
        # qkv = self.qkv(x)
        flops += N * self.dim * 3 * self.dim
        # attn = (q @ k.transpose(-2, -1))
        flops += self.num_heads * N * (self.dim // self.num_heads) * N
        #  x = (attn @ v)
        flops += self.num_heads * N * N * (self.dim // self.num_heads)
        # x = self.proj(x)
        flops += N * self.dim * self.dim
        return flops
```

这个计算过程，我们用windows size = 2为例来看一下计算过程。图片取自链接[transformer入门 论文阅读(4) Swin Transformer | shifted window,relative position bias详解](https://zhuanlan.zhihu.com/p/507105020)

![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/2.png)


通过这个图示，是比较容易理解相对位置编码的计算过程的，下面我们在实际的代码上跑一下，看看实际的数值变化，以及在forward中的计算过程。

我们使用swin transformer的imagenet image classification任务为例，逐步来解释每行代码。在这个任务中，window_size = 7。

# 1. 定义relative_position_bias_table
```python
        # define a parameter table of relative position bias
        self.relative_position_bias_table = nn.Parameter(
            torch.zeros((2 * window_size[0] - 1) * (2 * window_size[1] - 1), num_heads))  # 2*Wh-1 * 2*Ww-1, nH
```

这个定义了relative_position_bias_table,对应上图示中的relative_position_bias_table。

这个值的初始化值为shape为[169, 4]的全0值。169是(2 * window_size[0] - 1) * (2 * window_size[1] - 1),也就是(2*7-1)*(2*7-1) = 169.

然后将其初始化为一个服从截断正态分布的随机值，标准差为 0.02。截断正态分布的范围通常限制在均值两侧一定范围内，避免生成过大或过小的值。

```python
trunc_normal_(self.relative_position_bias_table, std=.02)
```

经过截断和正态分布的初始化后，self.relative_position_bias_table的shape是[169, 4]，说明有169个相对位置可以索引，有4个头。

self.relative_position_bias_table的值是：
```python
self.relative_position_bias_table = Parameter containing:
tensor([[ 1.3016e-02,  1.2930e-02,  1.5971e-02, -2.9950e-02],
        [-1.2150e-02, -1.8186e-02,  1.8201e-02, -2.9683e-02],
        [-1.4085e-03, -9.6917e-03,  1.7187e-02, -2.1197e-02],
        [ 4.5870e-04, -2.5759e-02,  1.0428e-02,  7.8378e-03],
        [-1.9345e-02,  2.5859e-02, -5.3094e-02, -1.9221e-02],
        [-1.3431e-02,  3.0673e-02,  1.8304e-02,  1.1444e-02],
        [-7.7201e-03, -1.0047e-03,  8.4661e-03,  1.8223e-02],
        [-3.3187e-03,  3.2440e-02, -1.9514e-02, -1.2083e-02],
        [ 4.3020e-04, -1.2444e-02,  1.9337e-02,  3.7373e-03],
        [-1.0259e-03, -2.5004e-03, -5.6262e-03,  1.7836e-02],
        [ 2.2084e-02,  1.1696e-02,  4.6045e-02, -7.9868e-03],
        [-1.2458e-02,  4.3781e-04,  9.5489e-03,  1.7944e-02],
        [-8.4995e-03,  1.6470e-02, -2.7924e-03, -2.1485e-02],
        [-1.3584e-02, -1.7652e-02,  3.8663e-04,  2.6110e-02],
        [ 1.3602e-02, -1.1777e-02, -1.3449e-02,  2.0151e-03],
        [ 6.7764e-03,  2.6319e-02, -2.2482e-02, -1.7044e-03],
        [ 1.5983e-03, -4.2924e-03,  2.1764e-02,  1.2783e-02],
        [ 4.6346e-03,  8.8023e-03,  1.5202e-02, -7.4724e-03],
        [ 2.4044e-02,  9.2407e-03,  8.6452e-03, -1.3761e-02],
        [-1.6994e-02, -2.1969e-03,  2.9485e-02,  3.4357e-02],
        [-5.7416e-03,  1.5623e-02,  2.0354e-03,  9.7194e-04],
        [ 1.7485e-02,  1.2262e-02,  8.5692e-03,  1.3812e-03],
        [-6.7575e-03,  3.1388e-02, -2.4174e-02, -1.1403e-03],
        [ 9.2829e-04, -4.4380e-04,  1.6360e-03,  2.0687e-02],
        [-2.0940e-02,  1.3357e-02,  1.9906e-02, -2.2522e-03],
        [-1.5761e-02, -2.1338e-02, -1.4347e-02,  9.6187e-03],
        [-6.5731e-03,  5.4773e-03,  9.6834e-03,  2.2648e-02],
        [-8.9935e-04,  1.9223e-02, -3.4717e-02,  5.4604e-03],
        [ 2.6296e-02,  1.0155e-02,  1.3775e-02,  4.2052e-02],
        [ 1.5174e-02,  2.5801e-03, -9.5923e-03,  9.3638e-03],
        [-3.5014e-02,  5.7512e-03, -2.1808e-02,  1.8485e-02],
        [-5.6106e-02, -2.2749e-02,  1.1917e-03,  1.2215e-02],
        [ 1.7805e-03, -1.0686e-02, -7.5165e-03, -3.1701e-02],
        [ 1.1049e-02, -2.1858e-02, -3.0315e-02,  1.9651e-02],
        [ 7.7334e-04,  2.9269e-02, -1.0484e-02,  4.2932e-03],
        [ 1.8748e-02,  4.5477e-02, -1.9996e-02,  1.4368e-03],
        [-1.3108e-03,  1.1532e-02,  1.4487e-02, -1.2269e-02],
        [ 1.0964e-02,  1.3022e-02,  6.2545e-03, -3.7798e-04],
        [ 7.6258e-03, -2.4383e-02, -1.5096e-02,  4.0063e-02],
        [ 7.6106e-03,  3.7190e-02,  1.2890e-02,  3.5808e-03],
        [ 1.4081e-02, -3.8065e-02,  4.2530e-02,  2.9447e-02],
        [ 1.1421e-02,  1.0587e-02, -2.0800e-02,  1.6341e-02],
        [-2.7314e-02, -2.8962e-03,  1.4677e-02,  2.6306e-02],
        [-7.7345e-05, -6.3499e-03,  4.8553e-03,  1.6270e-02],
        [ 2.8418e-03,  5.9740e-03,  4.0203e-03,  3.6122e-02],
        [ 7.5861e-03,  4.3979e-02, -6.4084e-03, -3.2667e-02],
        [-1.9038e-02, -2.4783e-02, -1.1434e-02, -8.2354e-03],
        [ 8.8039e-03, -8.5791e-03,  2.7949e-02, -2.0321e-03],
        [-3.1587e-02, -5.5455e-03,  4.2756e-02, -3.8662e-03],
        [ 1.0159e-02, -1.7940e-02, -8.3835e-03, -1.1040e-02],
        [-1.2910e-02, -1.8785e-02, -1.8383e-03,  1.0948e-02],
        [-7.2788e-03,  9.1596e-03, -9.0019e-03,  2.6330e-02],
        [ 2.9545e-02,  4.5662e-03, -1.1328e-02,  1.6133e-02],
        [-3.9723e-03, -2.2513e-02,  5.2934e-03, -1.6365e-03],
        [-1.3563e-02, -1.4569e-02,  1.0447e-02,  1.0109e-02],
        [-9.4960e-03, -3.1889e-02, -1.5388e-04,  5.7821e-03],
        [-2.4407e-02, -2.3761e-02,  3.2310e-03, -4.0229e-03],
        [ 8.4969e-03,  2.1986e-02,  8.5039e-03,  6.7387e-03],
        [-6.2493e-03, -1.5181e-02,  1.4464e-02, -6.8173e-03],
        [ 2.2028e-02,  4.7522e-03, -2.5576e-02,  3.3736e-02],
        [ 4.0798e-02,  7.3145e-03,  1.4472e-02, -6.8801e-03],
        [ 3.1932e-02,  8.9403e-03, -9.6709e-03,  1.3000e-02],
        [-5.3350e-03, -2.0686e-02,  1.3782e-02,  1.3395e-02],
        [-1.4098e-02,  2.0414e-02, -5.0479e-03, -1.8073e-02],
        [ 2.6907e-02,  1.0896e-02,  2.0083e-02, -3.4066e-02],
        [ 9.4837e-03, -1.4148e-02, -3.6911e-02, -2.0351e-02],
        [ 5.1210e-03,  2.2324e-02,  1.1604e-02,  7.3071e-03],
        [ 1.6581e-04, -1.6450e-02,  9.2460e-03, -1.6927e-02],
        [ 1.0261e-02,  2.8199e-02, -6.2669e-03, -3.2156e-02],
        [-5.3347e-02, -1.9335e-02, -1.4482e-02,  1.3195e-02],
        [-8.8063e-03, -6.5125e-04,  2.0097e-02,  1.3497e-02],
        [-2.8513e-02, -1.8314e-02,  5.8903e-02,  3.9059e-03],
        [-1.5324e-02,  5.0366e-03,  2.8005e-02,  2.0570e-02],
        [-1.2745e-03,  1.0042e-02,  1.3696e-03,  1.0592e-02],
        [ 1.5763e-02, -2.1932e-02,  1.5765e-02, -2.9425e-02],
        [ 1.2498e-03, -6.3326e-03,  2.9821e-02, -1.0391e-02],
        [-1.8563e-02, -3.9632e-03,  1.6043e-02,  1.6001e-02],
        [-1.2490e-02,  1.0495e-02,  6.0373e-03,  1.3737e-02],
        [ 2.1737e-03, -3.0986e-02,  1.3727e-02, -2.3079e-02],
        [-3.1883e-03,  3.2901e-02, -2.5188e-02, -2.5408e-03],
        [ 1.5790e-02,  5.9349e-03, -2.1869e-02,  2.1607e-02],
        [-3.6255e-02, -1.9680e-03,  1.6092e-02,  2.3690e-02],
        [-1.4711e-02, -1.3424e-02, -1.3756e-03, -1.3826e-03],
        [ 4.1464e-02,  7.6075e-03,  5.3314e-03, -1.4585e-03],
        [-2.7874e-02, -3.6342e-02,  2.8827e-02, -2.3673e-02],
        [ 8.9761e-03, -1.1548e-02, -2.5437e-02,  1.5095e-02],
        [-1.6958e-02, -6.0754e-03, -1.3342e-02, -7.5932e-04],
        [-2.0880e-02, -1.2093e-02,  4.1462e-02,  1.8901e-02],
        [ 1.7619e-02,  2.1022e-02, -9.3313e-03, -5.8364e-02],
        [-1.1053e-02,  4.1340e-03, -5.1482e-03,  5.8287e-02],
        [-2.2730e-02, -1.1736e-02,  6.2054e-03,  2.0684e-02],
        [-1.9601e-03,  3.7864e-02,  1.7817e-02, -1.0492e-02],
        [ 5.9987e-03,  1.4022e-02, -1.9769e-02,  1.7431e-02],
        [ 7.5007e-03, -2.3185e-05,  3.3554e-02,  2.4122e-02],
        [ 5.2461e-03, -1.8073e-02, -1.2494e-02,  1.1941e-03],
        [ 1.0643e-02,  8.7715e-03, -2.1406e-02, -1.8917e-02],
        [ 1.1413e-02, -1.9722e-02,  3.8593e-02, -3.3243e-03],
        [ 5.7060e-03,  3.4061e-02,  7.5954e-03, -1.3419e-02],
        [ 3.7368e-02, -3.3992e-02, -6.9826e-04,  2.7099e-02],
        [-1.1508e-02, -1.5148e-03, -1.4152e-02, -1.4290e-02],
        [ 7.9610e-05, -1.8641e-02, -2.4754e-04,  4.3843e-03],
        [-2.0458e-02, -1.9500e-02, -8.5889e-03, -1.1266e-03],
        [-2.0769e-02,  1.7289e-02,  1.0407e-02, -1.3742e-02],
        [ 1.7868e-02,  1.6091e-02,  8.7427e-03, -1.2668e-02],
        [ 8.4326e-03, -2.2689e-02,  1.2183e-03, -3.8219e-02],
        [ 2.2592e-02,  4.5847e-02,  4.3876e-02,  1.2579e-02],
        [-1.2289e-03, -3.1784e-02, -8.1138e-03, -1.5119e-02],
        [ 3.4758e-02, -3.7492e-02,  3.5903e-02,  1.7103e-02],
        [-3.3782e-03, -2.7443e-02, -9.5681e-03,  1.4193e-02],
        [-7.7820e-03, -1.3029e-03,  2.4312e-02,  2.2949e-02],
        [ 1.5239e-02, -9.0775e-03, -4.7782e-03,  1.4884e-02],
        [ 6.9858e-03, -1.8969e-02,  5.8400e-03, -3.2343e-03],
        [-1.9832e-02, -1.5367e-02,  1.5907e-02, -9.3626e-03],
        [-1.9557e-02,  1.3588e-03,  4.5522e-03, -3.7315e-02],
        [ 2.3966e-02, -4.0572e-03,  1.8210e-02,  2.3433e-02],
        [-2.3314e-02, -1.2452e-02,  1.1883e-02, -4.2737e-03],
        [ 1.0164e-02, -1.3321e-02, -3.0517e-02, -1.2612e-02],
        [-1.7164e-02, -1.1270e-02,  1.8922e-02, -5.7191e-04],
        [ 7.7203e-03, -2.3187e-02, -1.6683e-02,  4.5915e-03],
        [-1.0443e-02,  2.1088e-02, -2.4845e-02, -3.6504e-02],
        [-1.9563e-02,  2.1145e-03, -1.7736e-02,  5.4685e-03],
        [ 1.9292e-02, -2.1555e-02,  3.7730e-02,  1.7448e-02],
        [-4.0698e-03, -1.3026e-02, -3.4614e-03, -1.2565e-02],
        [ 2.7636e-03,  2.5618e-02,  2.3021e-02,  3.1980e-02],
        [-4.8650e-03,  1.5228e-02, -2.2261e-02, -1.3199e-02],
        [ 3.0921e-02, -1.2894e-02, -1.2497e-02, -6.8760e-03],
        [ 2.3839e-02,  4.7479e-02,  2.3177e-02,  5.3229e-03],
        [ 2.1135e-02,  2.2877e-02, -1.1015e-02,  1.5864e-02],
        [ 1.9515e-02,  1.3216e-02, -3.1788e-02, -1.6233e-02],
        [-2.1048e-02, -7.3920e-03,  3.1444e-02,  1.8908e-02],
        [ 5.0643e-03,  8.6849e-03,  1.7268e-02,  3.2652e-02],
        [-3.5067e-02,  1.4977e-02,  1.1388e-02,  2.4333e-03],
        [-2.1766e-02, -6.3311e-03, -1.3955e-02, -1.2402e-02],
        [-1.1353e-02,  3.3777e-03,  3.6054e-02, -1.9402e-03],
        [-2.0221e-02, -2.8297e-02, -3.0129e-02, -2.7697e-02],
        [-1.4904e-02, -2.2244e-02,  1.4196e-02,  4.6532e-03],
        [-1.8982e-03, -1.3293e-03, -2.0238e-03,  3.2632e-03],
        [-3.9296e-02,  8.8819e-03, -1.7834e-02,  2.9087e-03],
        [ 2.3470e-03, -3.6545e-02,  6.1637e-03, -1.9010e-02],
        [ 3.9907e-03,  5.5000e-02, -3.8467e-03,  1.3024e-02],
        [ 9.1448e-03,  3.2606e-02,  6.1422e-03,  5.1953e-02],
        [ 2.4093e-02,  2.2630e-02, -2.4687e-02, -1.3339e-02],
        [-7.2034e-03,  1.0297e-02, -1.9853e-02,  1.4095e-02],
        [-2.0765e-02, -2.1659e-02, -2.0595e-02, -1.4443e-02],
        [ 3.3763e-02, -3.1403e-02,  2.1049e-02,  2.5837e-03],
        [ 3.0665e-02,  1.2386e-02,  1.2574e-02, -3.1211e-02],
        [ 2.7490e-02,  1.5746e-02, -4.8245e-02, -2.9570e-03],
        [-1.0205e-02,  1.0521e-03,  2.6722e-02,  2.4740e-02],
        [ 2.0500e-02, -2.7584e-03,  1.3663e-02, -2.0351e-02],
        [ 8.4086e-04,  2.0359e-03,  5.2398e-02,  3.3844e-02],
        [ 1.2377e-02, -1.3887e-02,  1.6044e-02, -7.6531e-03],
        [-5.5555e-03, -2.6389e-03,  2.2808e-03,  9.7132e-03],
        [-1.6457e-02,  1.1468e-02,  1.6928e-02,  7.1116e-03],
        [ 3.2856e-02, -1.2338e-03,  1.0169e-02,  3.6774e-02],
        [ 1.0192e-02,  3.1657e-02, -4.4118e-03,  3.2392e-02],
        [-3.3427e-03,  1.1179e-03,  3.9311e-03, -2.5325e-02],
        [-9.0263e-03,  2.6784e-03, -1.7415e-02, -3.3446e-03],
        [ 2.9855e-02,  1.3989e-03, -1.1745e-02, -1.3773e-04],
        [-1.3534e-02,  4.2401e-02, -1.8659e-02,  1.7727e-02],
        [-7.7467e-03, -6.9044e-03, -4.6074e-02,  2.0767e-02],
        [-4.0125e-02, -2.4978e-02,  1.1654e-02,  2.3009e-02],
        [-9.8242e-03,  3.4488e-03, -2.3044e-04, -1.5239e-02],
        [ 5.2063e-03, -1.0426e-02,  4.4600e-03,  1.2304e-02],
        [ 9.6086e-03, -8.3992e-03,  4.0642e-03, -6.5978e-03],
        [ 1.3690e-02,  9.3781e-04, -4.0357e-03, -1.6689e-05],
        [-4.6959e-03, -1.1017e-02,  1.3361e-02,  7.7851e-03],
        [ 1.7211e-02, -9.5882e-03,  6.2699e-02,  7.8999e-03],
        [ 1.5927e-02, -5.5237e-02,  1.6605e-02, -1.4664e-02],
        [-2.6448e-02,  8.7442e-03,  5.1785e-03,  3.0192e-02]],
       requires_grad=True)
```


这个shape的原因是：

相对位置的意义为：对于窗口注意力机制，每个 token 的位置都是相对于窗口内其他 token 定义的。窗口大小为 `(Wh, Ww)`，窗口内总共有 `Wh * Ww` 个 token。相对位置表示的是两个 token 在垂直方向（高度）和水平方向（宽度）上的偏移量。

例如：
- 一个窗口大小为 `(3, 3)`：
  - 水平相对位置范围是：`[-2, -1, 0, 1, 2]`（总共 `2 * Wh - 1 = 5`）。
  - 垂直相对位置范围是：`[-2, -1, 0, 1, 2]`（总共 `2 * Ww - 1 = 5`）。

这意味着在 2D 平面中，窗口内的 token 之间的相对位置总共有：
```python
(2 * Wh - 1) * (2 * Ww - 1)
```
例如，`(3, 3)` 窗口有 `5 * 5 = 25` 种可能的相对位置。

---

self.relative_position_bias_table` 的形状是(2 * window_size[0] - 1) * (2 * window_size[1] - 1), num_heads)

- **第一维度**：`(2 * Wh - 1) * (2 * Ww - 1)`，表示所有可能的相对位置。
- **第二维度**：`num_heads`，因为每个注意力头都会有一个单独的偏置。

例如：
- 窗口大小 `(3, 3)`，有 `25` 种可能的相对位置，`num_heads=8`。
- 则 `relative_position_bias_table` 的形状为 `(25, 8)`。

这一表将存储每个相对位置对于每个注意力头的偏置值。



# 2.获取绝对位置

```python
# get pair-wise relative position index for each token inside the window
        coords_h = torch.arange(self.window_size[0])
        coords_w = torch.arange(self.window_size[1])
        coords = torch.stack(torch.meshgrid([coords_h, coords_w]))  # 2, Wh, Ww
        coords_flatten = torch.flatten(coords, 1)  # 2, Wh*Ww
```
在这里，

`coords_h = tensor([0, 1, 2, 3, 4, 5, 6]), coords_w = tensor([0, 1, 2, 3, 4, 5, 6])`

经过meshgrid和stack计算之后，

```python
coords = tensor([[[0, 0, 0, 0, 0, 0, 0],
         [1, 1, 1, 1, 1, 1, 1],
         [2, 2, 2, 2, 2, 2, 2],
         [3, 3, 3, 3, 3, 3, 3],
         [4, 4, 4, 4, 4, 4, 4],
         [5, 5, 5, 5, 5, 5, 5],
         [6, 6, 6, 6, 6, 6, 6]],

        [[0, 1, 2, 3, 4, 5, 6],
         [0, 1, 2, 3, 4, 5, 6],
         [0, 1, 2, 3, 4, 5, 6],
         [0, 1, 2, 3, 4, 5, 6],
         [0, 1, 2, 3, 4, 5, 6],
         [0, 1, 2, 3, 4, 5, 6],
         [0, 1, 2, 3, 4, 5, 6]]])
```

用图示表示就是

![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/3.png)


然后经过flatten计算


```python
coords_flatten = tensor(
[[0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,6],
[0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2,3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6]])
```
coords_flatten.shape = torch.Size([2, 49])

展平后代表的是相同的意义，只是排列形式发生了变化。

# 3.获取相对位置索引（通过绝对位置相减）

```python
relative_coords = coords_flatten[:, :, None] - coords_flatten[:, None, :]  # 2, Wh*Ww, Wh*Ww
relative_coords = relative_coords.permute(1, 2, 0).contiguous()  # Wh*Ww, Wh*Ww, 2
```

coords_flatten[:, :, None]是shape为[2, 49, 1]的tensor。None在最后添加了一维。

```python
coords_flatten[:, :, None] = tensor([[[0],
         [0],
         [0],
         [0],
         [0],
         [0],
         [0],
         [1],
         [1],
         [1],
         [1],
         [1],
         [1],
         [1],
         [2],
         [2],
         [2],
         [2],
         [2],
         [2],
         [2],
         [3],
         [3],
         [3],
         [3],
         [3],
         [3],
         [3],
         [4],
         [4],
         [4],
         [4],
         [4],
         [4],
         [4],
         [5],
         [5],
         [5],
         [5],
         [5],
         [5],
         [5],
         [6],
         [6],
         [6],
         [6],
         [6],
         [6],
         [6]],

        [[0],
         [1],
         [2],
         [3],
         [4],
         [5],
         [6],
         [0],
         [1],
         [2],
         [3],
         [4],
         [5],
         [6],
         [0],
         [1],
         [2],
         [3],
         [4],
         [5],
         [6],
         [0],
         [1],
         [2],
         [3],
         [4],
         [5],
         [6],
         [0],
         [1],
         [2],
         [3],
         [4],
         [5],
         [6],
         [0],
         [1],
         [2],
         [3],
         [4],
         [5],
         [6],
         [0],
         [1],
         [2],
         [3],
         [4],
         [5],
         [6]]])
```

coords_flatten[:, None, :]是shape为[2, 1, 49]的tensor，None在中间添加了一维。

```python
coords_flatten[:, None, :] = tensor(
[[[0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3,3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6,6, 6, 6]],
[[0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1,2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3,4, 5, 6]]])
```

coords_flatten[:, None, :]与coords_flatten在数值上是一致的，只是多添加了一维。
```python
coords_flatten = tensor(
[[0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,6],
[0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2,3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6]])
```

coords_flatten[:, :, None]的shape是[2, 49, 1],coords_flatten[:, None, :]的shape是[2, 1, 49],通过广播机制进行相减，得到相对坐标relative_coords，`relative_coords = coords_flatten[:, :, None] - coords_flatten[:, None, :]`。

```python
relative_coords = 
tensor([[[ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2,
          -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4,
          -4, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
         [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2,
          -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4,
          -4, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
         [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2,
          -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4,
          -4, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
         [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2,
          -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4,
          -4, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
         [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2,
          -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4,
          -4, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
         [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2,
          -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4,
          -4, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
         [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2,
          -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4,
          -4, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
         [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
          -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3,
          -3, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
         [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
          -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3,
          -3, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
         [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
          -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3,
          -3, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
         [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
          -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3,
          -3, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
         [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
          -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3,
          -3, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
         [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
          -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3,
          -3, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
         [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1,
          -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3,
          -3, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
         [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,
           0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2,
          -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
         [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,
           0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2,
          -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
         [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,
           0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2,
          -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
         [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,
           0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2,
          -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
         [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,
           0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2,
          -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
         [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,
           0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2,
          -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
         [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,
           0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2,
          -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
         [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,
           1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1,
          -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
         [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,
           1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1,
          -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
         [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,
           1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1,
          -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
         [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,
           1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1,
          -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
         [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,
           1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1,
          -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
         [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,
           1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1,
          -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
         [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,
           1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1,
          -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
         [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,
           2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,
           0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
         [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,
           2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,
           0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
         [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,
           2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,
           0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
         [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,
           2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,
           0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
         [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,
           2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,
           0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
         [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,
           2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,
           0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
         [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,
           2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,
           0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
         [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,
           3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,
           1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
         [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,
           3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,
           1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
         [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,
           3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,
           1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
         [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,
           3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,
           1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
         [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,
           3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,
           1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
         [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,
           3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,
           1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
         [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,
           3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,
           1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
         [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,
           4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,
           2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
         [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,
           4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,
           2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
         [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,
           4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,
           2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
         [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,
           4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,
           2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
         [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,
           4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,
           2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
         [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,
           4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,
           2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
         [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,
           4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,
           2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0]],

        [[ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2,
          -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5,
          -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
         [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1,
          -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4,
          -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
         [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0,
          -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3,
          -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
         [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,
           0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2,
          -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
         [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,
           1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1,
          -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
         [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,
           2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0,
          -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
         [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,
           3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,
           0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
         [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2,
          -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5,
          -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
         [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1,
          -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4,
          -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
         [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0,
          -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3,
          -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
         [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,
           0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2,
          -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
         [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,
           1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1,
          -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
         [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,
           2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0,
          -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
         [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,
           3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,
           0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
         [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2,
          -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5,
          -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
         [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1,
          -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4,
          -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
         [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0,
          -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3,
          -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
         [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,
           0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2,
          -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
         [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,
           1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1,
          -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
         [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,
           2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0,
          -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
         [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,
           3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,
           0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
         [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2,
          -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5,
          -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
         [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1,
          -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4,
          -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
         [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0,
          -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3,
          -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
         [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,
           0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2,
          -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
         [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,
           1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1,
          -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
         [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,
           2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0,
          -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
         [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,
           3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,
           0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
         [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2,
          -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5,
          -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
         [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1,
          -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4,
          -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
         [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0,
          -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3,
          -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
         [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,
           0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2,
          -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
         [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,
           1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1,
          -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
         [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,
           2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0,
          -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
         [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,
           3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,
           0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
         [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2,
          -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5,
          -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
         [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1,
          -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4,
          -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
         [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0,
          -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3,
          -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
         [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,
           0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2,
          -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
         [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,
           1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1,
          -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
         [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,
           2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0,
          -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
         [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,
           3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,
           0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
         [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2,
          -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5,
          -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
         [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1,
          -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4,
          -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
         [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0,
          -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3,
          -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
         [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,
           0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2,
          -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
         [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,
           1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1,
          -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
         [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,
           2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0,
          -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
         [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,
           3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,
           0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0]]])

```
relative_coords的shape是torch.Size([2, 49, 49])。

针对relative_coords的第[2,0,49]的数值，用图示所示就是下图所示，以蓝色点为参考点，其他点相对参考点的距离。

![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/blue.png)

然后以黄色点为参考点，其他点相对参考点的距离。

![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/orange.png)

剩下的依次类推。

整体就是知乎文章图中这部分
![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/4.png)
的扩展。

# 4. 将shape为[2,49,49]relative_coords的49个不同参考点的相对距离值拉成一维

```python
relative_coords = relative_coords.permute(1, 2, 0).contiguous()  # Wh*Ww, Wh*Ww, 2
```
此操作对应示例中的
![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/6.png)

经过处理后，relative_coords的shape是[49, 49, 2]。他的值可以用下面的图示表示：
![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/5.png)

即将以每一个参考点来说，其他位置的点的相对距离，都放在一行上。relative_coords的值是：
```python
tensor([[[ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [ 0, -6],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-1, -6],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-2, -6],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-3, -5],
         [-3, -6],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4],
         [-4, -5],
         [-4, -6],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-5, -3],
         [-5, -4],
         [-5, -5],
         [-5, -6],
         [-6,  0],
         [-6, -1],
         [-6, -2],
         [-6, -3],
         [-6, -4],
         [-6, -5],
         [-6, -6]],

        [[ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-3, -5],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4],
         [-4, -5],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-5, -3],
         [-5, -4],
         [-5, -5],
         [-6,  1],
         [-6,  0],
         [-6, -1],
         [-6, -2],
         [-6, -3],
         [-6, -4],
         [-6, -5]],

        [[ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-5, -3],
         [-5, -4],
         [-6,  2],
         [-6,  1],
         [-6,  0],
         [-6, -1],
         [-6, -2],
         [-6, -3],
         [-6, -4]],

        [[ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-5,  3],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-5, -3],
         [-6,  3],
         [-6,  2],
         [-6,  1],
         [-6,  0],
         [-6, -1],
         [-6, -2],
         [-6, -3]],

        [[ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-5,  4],
         [-5,  3],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-6,  4],
         [-6,  3],
         [-6,  2],
         [-6,  1],
         [-6,  0],
         [-6, -1],
         [-6, -2]],

        [[ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-3,  5],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-4,  5],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-5,  5],
         [-5,  4],
         [-5,  3],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-6,  5],
         [-6,  4],
         [-6,  3],
         [-6,  2],
         [-6,  1],
         [-6,  0],
         [-6, -1]],

        [[ 0,  6],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [-1,  6],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-2,  6],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-3,  6],
         [-3,  5],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-4,  6],
         [-4,  5],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-5,  6],
         [-5,  5],
         [-5,  4],
         [-5,  3],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-6,  6],
         [-6,  5],
         [-6,  4],
         [-6,  3],
         [-6,  2],
         [-6,  1],
         [-6,  0]],

        [[ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 1, -6],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [ 0, -6],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-1, -6],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-2, -6],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-3, -5],
         [-3, -6],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4],
         [-4, -5],
         [-4, -6],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-5, -3],
         [-5, -4],
         [-5, -5],
         [-5, -6]],

        [[ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-3, -5],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4],
         [-4, -5],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-5, -3],
         [-5, -4],
         [-5, -5]],

        [[ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-5, -3],
         [-5, -4]],

        [[ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-5,  3],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-5, -2],
         [-5, -3]],

        [[ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-5,  4],
         [-5,  3],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-5, -1],
         [-5, -2]],

        [[ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-3,  5],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-4,  5],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-5,  5],
         [-5,  4],
         [-5,  3],
         [-5,  2],
         [-5,  1],
         [-5,  0],
         [-5, -1]],

        [[ 1,  6],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 0,  6],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [-1,  6],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-2,  6],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-3,  6],
         [-3,  5],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-4,  6],
         [-4,  5],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-5,  6],
         [-5,  5],
         [-5,  4],
         [-5,  3],
         [-5,  2],
         [-5,  1],
         [-5,  0]],

        [[ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 2, -6],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 1, -6],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [ 0, -6],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-1, -6],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-2, -6],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-3, -5],
         [-3, -6],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4],
         [-4, -5],
         [-4, -6]],

        [[ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-3, -5],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4],
         [-4, -5]],

        [[ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3],
         [-4, -4]],

        [[ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2],
         [-4, -3]],

        [[ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1],
         [-4, -2]],

        [[ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-3,  5],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-4,  5],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0],
         [-4, -1]],

        [[ 2,  6],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 1,  6],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 0,  6],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [-1,  6],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-2,  6],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-3,  6],
         [-3,  5],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-4,  6],
         [-4,  5],
         [-4,  4],
         [-4,  3],
         [-4,  2],
         [-4,  1],
         [-4,  0]],

        [[ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 3, -5],
         [ 3, -6],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 2, -6],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 1, -6],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [ 0, -6],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-1, -6],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-2, -6],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-3, -5],
         [-3, -6]],

        [[ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 3, -5],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4],
         [-3, -5]],

        [[ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3],
         [-3, -4]],

        [[ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2],
         [-3, -3]],

        [[ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1],
         [-3, -2]],

        [[ 3,  5],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-3,  5],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0],
         [-3, -1]],

        [[ 3,  6],
         [ 3,  5],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 2,  6],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 1,  6],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 0,  6],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [-1,  6],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-2,  6],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-3,  6],
         [-3,  5],
         [-3,  4],
         [-3,  3],
         [-3,  2],
         [-3,  1],
         [-3,  0]],

        [[ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 4, -5],
         [ 4, -6],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 3, -5],
         [ 3, -6],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 2, -6],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 1, -6],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [ 0, -6],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-1, -6],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5],
         [-2, -6]],

        [[ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 4, -5],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 3, -5],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4],
         [-2, -5]],

        [[ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3],
         [-2, -4]],

        [[ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2],
         [-2, -3]],

        [[ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1],
         [-2, -2]],

        [[ 4,  5],
         [ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 3,  5],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0],
         [-2, -1]],

        [[ 4,  6],
         [ 4,  5],
         [ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 3,  6],
         [ 3,  5],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 2,  6],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 1,  6],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 0,  6],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [-1,  6],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-2,  6],
         [-2,  5],
         [-2,  4],
         [-2,  3],
         [-2,  2],
         [-2,  1],
         [-2,  0]],

        [[ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 5, -3],
         [ 5, -4],
         [ 5, -5],
         [ 5, -6],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 4, -5],
         [ 4, -6],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 3, -5],
         [ 3, -6],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 2, -6],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 1, -6],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [ 0, -6],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5],
         [-1, -6]],

        [[ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 5, -3],
         [ 5, -4],
         [ 5, -5],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 4, -5],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 3, -5],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4],
         [-1, -5]],

        [[ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 5, -3],
         [ 5, -4],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3],
         [-1, -4]],

        [[ 5,  3],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 5, -3],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2],
         [-1, -3]],

        [[ 5,  4],
         [ 5,  3],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1],
         [-1, -2]],

        [[ 5,  5],
         [ 5,  4],
         [ 5,  3],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 4,  5],
         [ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 3,  5],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0],
         [-1, -1]],

        [[ 5,  6],
         [ 5,  5],
         [ 5,  4],
         [ 5,  3],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 4,  6],
         [ 4,  5],
         [ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 3,  6],
         [ 3,  5],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 2,  6],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 1,  6],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 0,  6],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [-1,  6],
         [-1,  5],
         [-1,  4],
         [-1,  3],
         [-1,  2],
         [-1,  1],
         [-1,  0]],

        [[ 6,  0],
         [ 6, -1],
         [ 6, -2],
         [ 6, -3],
         [ 6, -4],
         [ 6, -5],
         [ 6, -6],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 5, -3],
         [ 5, -4],
         [ 5, -5],
         [ 5, -6],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 4, -5],
         [ 4, -6],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 3, -5],
         [ 3, -6],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 2, -6],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 1, -6],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5],
         [ 0, -6]],

        [[ 6,  1],
         [ 6,  0],
         [ 6, -1],
         [ 6, -2],
         [ 6, -3],
         [ 6, -4],
         [ 6, -5],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 5, -3],
         [ 5, -4],
         [ 5, -5],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 4, -5],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 3, -5],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 2, -5],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 1, -5],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4],
         [ 0, -5]],

        [[ 6,  2],
         [ 6,  1],
         [ 6,  0],
         [ 6, -1],
         [ 6, -2],
         [ 6, -3],
         [ 6, -4],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 5, -3],
         [ 5, -4],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 4, -4],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 3, -4],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 2, -4],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 1, -4],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3],
         [ 0, -4]],

        [[ 6,  3],
         [ 6,  2],
         [ 6,  1],
         [ 6,  0],
         [ 6, -1],
         [ 6, -2],
         [ 6, -3],
         [ 5,  3],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 5, -3],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 4, -3],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 3, -3],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 2, -3],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 1, -3],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2],
         [ 0, -3]],

        [[ 6,  4],
         [ 6,  3],
         [ 6,  2],
         [ 6,  1],
         [ 6,  0],
         [ 6, -1],
         [ 6, -2],
         [ 5,  4],
         [ 5,  3],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 5, -2],
         [ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 4, -2],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 3, -2],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 2, -2],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 1, -2],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1],
         [ 0, -2]],

        [[ 6,  5],
         [ 6,  4],
         [ 6,  3],
         [ 6,  2],
         [ 6,  1],
         [ 6,  0],
         [ 6, -1],
         [ 5,  5],
         [ 5,  4],
         [ 5,  3],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 5, -1],
         [ 4,  5],
         [ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 4, -1],
         [ 3,  5],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 3, -1],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 2, -1],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 1, -1],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0],
         [ 0, -1]],

        [[ 6,  6],
         [ 6,  5],
         [ 6,  4],
         [ 6,  3],
         [ 6,  2],
         [ 6,  1],
         [ 6,  0],
         [ 5,  6],
         [ 5,  5],
         [ 5,  4],
         [ 5,  3],
         [ 5,  2],
         [ 5,  1],
         [ 5,  0],
         [ 4,  6],
         [ 4,  5],
         [ 4,  4],
         [ 4,  3],
         [ 4,  2],
         [ 4,  1],
         [ 4,  0],
         [ 3,  6],
         [ 3,  5],
         [ 3,  4],
         [ 3,  3],
         [ 3,  2],
         [ 3,  1],
         [ 3,  0],
         [ 2,  6],
         [ 2,  5],
         [ 2,  4],
         [ 2,  3],
         [ 2,  2],
         [ 2,  1],
         [ 2,  0],
         [ 1,  6],
         [ 1,  5],
         [ 1,  4],
         [ 1,  3],
         [ 1,  2],
         [ 1,  1],
         [ 1,  0],
         [ 0,  6],
         [ 0,  5],
         [ 0,  4],
         [ 0,  3],
         [ 0,  2],
         [ 0,  1],
         [ 0,  0]]])
```

# 5.对横纵坐标值进行数值处理

```python
relative_coords[:, :, 0] += self.window_size[0] - 1  # shift to start from 0
relative_coords[:, :, 1] += self.window_size[1] - 1
relative_coords[:, :, 0] *= 2 * self.window_size[1] - 1
```

relative_coords[:, :, 0]代表的是所有的横坐标，relative_coords[:, :, 1]代表的是所有的纵坐标。

relative_coords[:, :, 0]和relative_coords[:, :, 1]的shape都是[49, 49]。

```python
relative_coords[:, :, 0] = 
tensor([[ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2,
         -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -5,
         -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
        [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2,
         -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -5,
         -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
        [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2,
         -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -5,
         -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
        [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2,
         -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -5,
         -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
        [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2,
         -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -5,
         -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
        [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2,
         -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -5,
         -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
        [ 0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2,
         -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -5,
         -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6],
        [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
         -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4,
         -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
        [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
         -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4,
         -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
        [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
         -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4,
         -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
        [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
         -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4,
         -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
        [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
         -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4,
         -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
        [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
         -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4,
         -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
        [ 1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1,
         -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4,
         -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5],
        [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,
          0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3,
         -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
        [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,
          0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3,
         -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
        [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,
          0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3,
         -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
        [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,
          0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3,
         -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
        [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,
          0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3,
         -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
        [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,
          0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3,
         -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
        [ 2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,
          0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -3,
         -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4],
        [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,
          1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2,
         -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
        [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,
          1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2,
         -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
        [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,
          1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2,
         -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
        [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,
          1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2,
         -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
        [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,
          1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2,
         -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
        [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,
          1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2,
         -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
        [ 3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,
          1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1, -2,
         -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3],
        [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
          2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1,
         -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
        [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
          2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1,
         -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
        [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
          2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1,
         -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
        [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
          2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1,
         -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
        [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
          2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1,
         -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
        [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
          2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1,
         -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
        [ 4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
          2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0, -1,
         -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2],
        [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,
          3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,
          0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
        [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,
          3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,
          0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
        [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,
          3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,
          0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
        [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,
          3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,
          0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
        [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,
          3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,
          0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
        [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,
          3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,
          0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
        [ 5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,
          3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,
          0,  0,  0,  0,  0,  0, -1, -1, -1, -1, -1, -1, -1],
        [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,
          4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,
          1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
        [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,
          4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,
          1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
        [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,
          4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,
          1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
        [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,
          4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,
          1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
        [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,
          4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,
          1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
        [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,
          4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,
          1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
        [ 6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,
          4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,
          1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0]])
```

```python
relative_coords[:, :, 1] = 
tensor([[ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3,
         -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0,
         -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
        [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2,
         -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,
          0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
        [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1,
         -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,
          1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
        [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0,
         -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,
          2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
        [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,
          0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,
          3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
        [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,
          1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,
          4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
        [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,
          2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,
          5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
        [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3,
         -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0,
         -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
        [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2,
         -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,
          0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
        [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1,
         -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,
          1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
        [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0,
         -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,
          2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
        [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,
          0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,
          3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
        [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,
          1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,
          4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
        [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,
          2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,
          5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
        [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3,
         -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0,
         -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
        [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2,
         -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,
          0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
        [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1,
         -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,
          1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
        [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0,
         -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,
          2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
        [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,
          0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,
          3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
        [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,
          1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,
          4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
        [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,
          2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,
          5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
        [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3,
         -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0,
         -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
        [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2,
         -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,
          0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
        [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1,
         -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,
          1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
        [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0,
         -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,
          2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
        [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,
          0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,
          3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
        [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,
          1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,
          4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
        [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,
          2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,
          5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
        [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3,
         -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0,
         -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
        [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2,
         -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,
          0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
        [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1,
         -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,
          1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
        [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0,
         -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,
          2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
        [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,
          0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,
          3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
        [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,
          1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,
          4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
        [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,
          2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,
          5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
        [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3,
         -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0,
         -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
        [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2,
         -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,
          0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
        [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1,
         -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,
          1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
        [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0,
         -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,
          2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
        [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,
          0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,
          3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
        [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,
          1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,
          4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
        [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,
          2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,
          5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0],
        [ 0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3,
         -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6,  0,
         -1, -2, -3, -4, -5, -6,  0, -1, -2, -3, -4, -5, -6],
        [ 1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2,
         -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5,  1,
          0, -1, -2, -3, -4, -5,  1,  0, -1, -2, -3, -4, -5],
        [ 2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1,
         -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4,  2,
          1,  0, -1, -2, -3, -4,  2,  1,  0, -1, -2, -3, -4],
        [ 3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0,
         -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3,  3,
          2,  1,  0, -1, -2, -3,  3,  2,  1,  0, -1, -2, -3],
        [ 4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,
          0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2,  4,
          3,  2,  1,  0, -1, -2,  4,  3,  2,  1,  0, -1, -2],
        [ 5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,
          1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1,  5,
          4,  3,  2,  1,  0, -1,  5,  4,  3,  2,  1,  0, -1],
        [ 6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,
          2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0,  6,
          5,  4,  3,  2,  1,  0,  6,  5,  4,  3,  2,  1,  0]])
```

第一步是横纵坐标都加6，避免距离值是负值。

```python
relative_coords[:, :, 0] += self.window_size[0] - 1  # shift to start from 0
relative_coords[:, :, 1] += self.window_size[1] - 1
```

经过计算后，relative_coords变成：

![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/7.png)

然后对横坐标乘以2 * self.window_size[1] - 1。

```python
relative_coords[:, :, 0] *= 2 * self.window_size[1] - 1
```

经过计算后，relative_coords的值为

![](https://borninfreedom.github.io/images/2025/swin_transformer_rpb/8.png)

对横坐标乘以2 * self.window_size[1] - 1后，这里面的最大值为左下角的(156,12)，156+12=168. 我们在最开始定义的relative_position_bias_table的shape也是（169， num_heads) 的，正好可以把relative_position_bias_table全部索引到。


```python
        # define a parameter table of relative position bias
        self.relative_position_bias_table = nn.Parameter(
            torch.zeros((2 * window_size[0] - 1) * (2 * window_size[1] - 1), num_heads))  # 2*Wh-1 * 2*Ww-1, nH
```

# 6. 横纵坐标加和

```python
relative_position_index = relative_coords.sum(-1)  # Wh*Ww, Wh*Ww
```

```python
relative_position_index = 
tensor([[ 84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
          58,  57,  56,  55,  54,  53,  52,  45,  44,  43,  42,  41,  40,  39,
          32,  31,  30,  29,  28,  27,  26,  19,  18,  17,  16,  15,  14,  13,
           6,   5,   4,   3,   2,   1,   0],
        [ 85,  84,  83,  82,  81,  80,  79,  72,  71,  70,  69,  68,  67,  66,
          59,  58,  57,  56,  55,  54,  53,  46,  45,  44,  43,  42,  41,  40,
          33,  32,  31,  30,  29,  28,  27,  20,  19,  18,  17,  16,  15,  14,
           7,   6,   5,   4,   3,   2,   1],
        [ 86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
          60,  59,  58,  57,  56,  55,  54,  47,  46,  45,  44,  43,  42,  41,
          34,  33,  32,  31,  30,  29,  28,  21,  20,  19,  18,  17,  16,  15,
           8,   7,   6,   5,   4,   3,   2],
        [ 87,  86,  85,  84,  83,  82,  81,  74,  73,  72,  71,  70,  69,  68,
          61,  60,  59,  58,  57,  56,  55,  48,  47,  46,  45,  44,  43,  42,
          35,  34,  33,  32,  31,  30,  29,  22,  21,  20,  19,  18,  17,  16,
           9,   8,   7,   6,   5,   4,   3],
        [ 88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
          62,  61,  60,  59,  58,  57,  56,  49,  48,  47,  46,  45,  44,  43,
          36,  35,  34,  33,  32,  31,  30,  23,  22,  21,  20,  19,  18,  17,
          10,   9,   8,   7,   6,   5,   4],
        [ 89,  88,  87,  86,  85,  84,  83,  76,  75,  74,  73,  72,  71,  70,
          63,  62,  61,  60,  59,  58,  57,  50,  49,  48,  47,  46,  45,  44,
          37,  36,  35,  34,  33,  32,  31,  24,  23,  22,  21,  20,  19,  18,
          11,  10,   9,   8,   7,   6,   5],
        [ 90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
          64,  63,  62,  61,  60,  59,  58,  51,  50,  49,  48,  47,  46,  45,
          38,  37,  36,  35,  34,  33,  32,  25,  24,  23,  22,  21,  20,  19,
          12,  11,  10,   9,   8,   7,   6],
        [ 97,  96,  95,  94,  93,  92,  91,  84,  83,  82,  81,  80,  79,  78,
          71,  70,  69,  68,  67,  66,  65,  58,  57,  56,  55,  54,  53,  52,
          45,  44,  43,  42,  41,  40,  39,  32,  31,  30,  29,  28,  27,  26,
          19,  18,  17,  16,  15,  14,  13],
        [ 98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
          72,  71,  70,  69,  68,  67,  66,  59,  58,  57,  56,  55,  54,  53,
          46,  45,  44,  43,  42,  41,  40,  33,  32,  31,  30,  29,  28,  27,
          20,  19,  18,  17,  16,  15,  14],
        [ 99,  98,  97,  96,  95,  94,  93,  86,  85,  84,  83,  82,  81,  80,
          73,  72,  71,  70,  69,  68,  67,  60,  59,  58,  57,  56,  55,  54,
          47,  46,  45,  44,  43,  42,  41,  34,  33,  32,  31,  30,  29,  28,
          21,  20,  19,  18,  17,  16,  15],
        [100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
          74,  73,  72,  71,  70,  69,  68,  61,  60,  59,  58,  57,  56,  55,
          48,  47,  46,  45,  44,  43,  42,  35,  34,  33,  32,  31,  30,  29,
          22,  21,  20,  19,  18,  17,  16],
        [101, 100,  99,  98,  97,  96,  95,  88,  87,  86,  85,  84,  83,  82,
          75,  74,  73,  72,  71,  70,  69,  62,  61,  60,  59,  58,  57,  56,
          49,  48,  47,  46,  45,  44,  43,  36,  35,  34,  33,  32,  31,  30,
          23,  22,  21,  20,  19,  18,  17],
        [102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
          76,  75,  74,  73,  72,  71,  70,  63,  62,  61,  60,  59,  58,  57,
          50,  49,  48,  47,  46,  45,  44,  37,  36,  35,  34,  33,  32,  31,
          24,  23,  22,  21,  20,  19,  18],
        [103, 102, 101, 100,  99,  98,  97,  90,  89,  88,  87,  86,  85,  84,
          77,  76,  75,  74,  73,  72,  71,  64,  63,  62,  61,  60,  59,  58,
          51,  50,  49,  48,  47,  46,  45,  38,  37,  36,  35,  34,  33,  32,
          25,  24,  23,  22,  21,  20,  19],
        [110, 109, 108, 107, 106, 105, 104,  97,  96,  95,  94,  93,  92,  91,
          84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
          58,  57,  56,  55,  54,  53,  52,  45,  44,  43,  42,  41,  40,  39,
          32,  31,  30,  29,  28,  27,  26],
        [111, 110, 109, 108, 107, 106, 105,  98,  97,  96,  95,  94,  93,  92,
          85,  84,  83,  82,  81,  80,  79,  72,  71,  70,  69,  68,  67,  66,
          59,  58,  57,  56,  55,  54,  53,  46,  45,  44,  43,  42,  41,  40,
          33,  32,  31,  30,  29,  28,  27],
        [112, 111, 110, 109, 108, 107, 106,  99,  98,  97,  96,  95,  94,  93,
          86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
          60,  59,  58,  57,  56,  55,  54,  47,  46,  45,  44,  43,  42,  41,
          34,  33,  32,  31,  30,  29,  28],
        [113, 112, 111, 110, 109, 108, 107, 100,  99,  98,  97,  96,  95,  94,
          87,  86,  85,  84,  83,  82,  81,  74,  73,  72,  71,  70,  69,  68,
          61,  60,  59,  58,  57,  56,  55,  48,  47,  46,  45,  44,  43,  42,
          35,  34,  33,  32,  31,  30,  29],
        [114, 113, 112, 111, 110, 109, 108, 101, 100,  99,  98,  97,  96,  95,
          88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
          62,  61,  60,  59,  58,  57,  56,  49,  48,  47,  46,  45,  44,  43,
          36,  35,  34,  33,  32,  31,  30],
        [115, 114, 113, 112, 111, 110, 109, 102, 101, 100,  99,  98,  97,  96,
          89,  88,  87,  86,  85,  84,  83,  76,  75,  74,  73,  72,  71,  70,
          63,  62,  61,  60,  59,  58,  57,  50,  49,  48,  47,  46,  45,  44,
          37,  36,  35,  34,  33,  32,  31],
        [116, 115, 114, 113, 112, 111, 110, 103, 102, 101, 100,  99,  98,  97,
          90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
          64,  63,  62,  61,  60,  59,  58,  51,  50,  49,  48,  47,  46,  45,
          38,  37,  36,  35,  34,  33,  32],
        [123, 122, 121, 120, 119, 118, 117, 110, 109, 108, 107, 106, 105, 104,
          97,  96,  95,  94,  93,  92,  91,  84,  83,  82,  81,  80,  79,  78,
          71,  70,  69,  68,  67,  66,  65,  58,  57,  56,  55,  54,  53,  52,
          45,  44,  43,  42,  41,  40,  39],
        [124, 123, 122, 121, 120, 119, 118, 111, 110, 109, 108, 107, 106, 105,
          98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
          72,  71,  70,  69,  68,  67,  66,  59,  58,  57,  56,  55,  54,  53,
          46,  45,  44,  43,  42,  41,  40],
        [125, 124, 123, 122, 121, 120, 119, 112, 111, 110, 109, 108, 107, 106,
          99,  98,  97,  96,  95,  94,  93,  86,  85,  84,  83,  82,  81,  80,
          73,  72,  71,  70,  69,  68,  67,  60,  59,  58,  57,  56,  55,  54,
          47,  46,  45,  44,  43,  42,  41],
        [126, 125, 124, 123, 122, 121, 120, 113, 112, 111, 110, 109, 108, 107,
         100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
          74,  73,  72,  71,  70,  69,  68,  61,  60,  59,  58,  57,  56,  55,
          48,  47,  46,  45,  44,  43,  42],
        [127, 126, 125, 124, 123, 122, 121, 114, 113, 112, 111, 110, 109, 108,
         101, 100,  99,  98,  97,  96,  95,  88,  87,  86,  85,  84,  83,  82,
          75,  74,  73,  72,  71,  70,  69,  62,  61,  60,  59,  58,  57,  56,
          49,  48,  47,  46,  45,  44,  43],
        [128, 127, 126, 125, 124, 123, 122, 115, 114, 113, 112, 111, 110, 109,
         102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
          76,  75,  74,  73,  72,  71,  70,  63,  62,  61,  60,  59,  58,  57,
          50,  49,  48,  47,  46,  45,  44],
        [129, 128, 127, 126, 125, 124, 123, 116, 115, 114, 113, 112, 111, 110,
         103, 102, 101, 100,  99,  98,  97,  90,  89,  88,  87,  86,  85,  84,
          77,  76,  75,  74,  73,  72,  71,  64,  63,  62,  61,  60,  59,  58,
          51,  50,  49,  48,  47,  46,  45],
        [136, 135, 134, 133, 132, 131, 130, 123, 122, 121, 120, 119, 118, 117,
         110, 109, 108, 107, 106, 105, 104,  97,  96,  95,  94,  93,  92,  91,
          84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
          58,  57,  56,  55,  54,  53,  52],
        [137, 136, 135, 134, 133, 132, 131, 124, 123, 122, 121, 120, 119, 118,
         111, 110, 109, 108, 107, 106, 105,  98,  97,  96,  95,  94,  93,  92,
          85,  84,  83,  82,  81,  80,  79,  72,  71,  70,  69,  68,  67,  66,
          59,  58,  57,  56,  55,  54,  53],
        [138, 137, 136, 135, 134, 133, 132, 125, 124, 123, 122, 121, 120, 119,
         112, 111, 110, 109, 108, 107, 106,  99,  98,  97,  96,  95,  94,  93,
          86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
          60,  59,  58,  57,  56,  55,  54],
        [139, 138, 137, 136, 135, 134, 133, 126, 125, 124, 123, 122, 121, 120,
         113, 112, 111, 110, 109, 108, 107, 100,  99,  98,  97,  96,  95,  94,
          87,  86,  85,  84,  83,  82,  81,  74,  73,  72,  71,  70,  69,  68,
          61,  60,  59,  58,  57,  56,  55],
        [140, 139, 138, 137, 136, 135, 134, 127, 126, 125, 124, 123, 122, 121,
         114, 113, 112, 111, 110, 109, 108, 101, 100,  99,  98,  97,  96,  95,
          88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
          62,  61,  60,  59,  58,  57,  56],
        [141, 140, 139, 138, 137, 136, 135, 128, 127, 126, 125, 124, 123, 122,
         115, 114, 113, 112, 111, 110, 109, 102, 101, 100,  99,  98,  97,  96,
          89,  88,  87,  86,  85,  84,  83,  76,  75,  74,  73,  72,  71,  70,
          63,  62,  61,  60,  59,  58,  57],
        [142, 141, 140, 139, 138, 137, 136, 129, 128, 127, 126, 125, 124, 123,
         116, 115, 114, 113, 112, 111, 110, 103, 102, 101, 100,  99,  98,  97,
          90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
          64,  63,  62,  61,  60,  59,  58],
        [149, 148, 147, 146, 145, 144, 143, 136, 135, 134, 133, 132, 131, 130,
         123, 122, 121, 120, 119, 118, 117, 110, 109, 108, 107, 106, 105, 104,
          97,  96,  95,  94,  93,  92,  91,  84,  83,  82,  81,  80,  79,  78,
          71,  70,  69,  68,  67,  66,  65],
        [150, 149, 148, 147, 146, 145, 144, 137, 136, 135, 134, 133, 132, 131,
         124, 123, 122, 121, 120, 119, 118, 111, 110, 109, 108, 107, 106, 105,
          98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
          72,  71,  70,  69,  68,  67,  66],
        [151, 150, 149, 148, 147, 146, 145, 138, 137, 136, 135, 134, 133, 132,
         125, 124, 123, 122, 121, 120, 119, 112, 111, 110, 109, 108, 107, 106,
          99,  98,  97,  96,  95,  94,  93,  86,  85,  84,  83,  82,  81,  80,
          73,  72,  71,  70,  69,  68,  67],
        [152, 151, 150, 149, 148, 147, 146, 139, 138, 137, 136, 135, 134, 133,
         126, 125, 124, 123, 122, 121, 120, 113, 112, 111, 110, 109, 108, 107,
         100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
          74,  73,  72,  71,  70,  69,  68],
        [153, 152, 151, 150, 149, 148, 147, 140, 139, 138, 137, 136, 135, 134,
         127, 126, 125, 124, 123, 122, 121, 114, 113, 112, 111, 110, 109, 108,
         101, 100,  99,  98,  97,  96,  95,  88,  87,  86,  85,  84,  83,  82,
          75,  74,  73,  72,  71,  70,  69],
        [154, 153, 152, 151, 150, 149, 148, 141, 140, 139, 138, 137, 136, 135,
         128, 127, 126, 125, 124, 123, 122, 115, 114, 113, 112, 111, 110, 109,
         102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
          76,  75,  74,  73,  72,  71,  70],
        [155, 154, 153, 152, 151, 150, 149, 142, 141, 140, 139, 138, 137, 136,
         129, 128, 127, 126, 125, 124, 123, 116, 115, 114, 113, 112, 111, 110,
         103, 102, 101, 100,  99,  98,  97,  90,  89,  88,  87,  86,  85,  84,
          77,  76,  75,  74,  73,  72,  71],
        [162, 161, 160, 159, 158, 157, 156, 149, 148, 147, 146, 145, 144, 143,
         136, 135, 134, 133, 132, 131, 130, 123, 122, 121, 120, 119, 118, 117,
         110, 109, 108, 107, 106, 105, 104,  97,  96,  95,  94,  93,  92,  91,
          84,  83,  82,  81,  80,  79,  78],
        [163, 162, 161, 160, 159, 158, 157, 150, 149, 148, 147, 146, 145, 144,
         137, 136, 135, 134, 133, 132, 131, 124, 123, 122, 121, 120, 119, 118,
         111, 110, 109, 108, 107, 106, 105,  98,  97,  96,  95,  94,  93,  92,
          85,  84,  83,  82,  81,  80,  79],
        [164, 163, 162, 161, 160, 159, 158, 151, 150, 149, 148, 147, 146, 145,
         138, 137, 136, 135, 134, 133, 132, 125, 124, 123, 122, 121, 120, 119,
         112, 111, 110, 109, 108, 107, 106,  99,  98,  97,  96,  95,  94,  93,
          86,  85,  84,  83,  82,  81,  80],
        [165, 164, 163, 162, 161, 160, 159, 152, 151, 150, 149, 148, 147, 146,
         139, 138, 137, 136, 135, 134, 133, 126, 125, 124, 123, 122, 121, 120,
         113, 112, 111, 110, 109, 108, 107, 100,  99,  98,  97,  96,  95,  94,
          87,  86,  85,  84,  83,  82,  81],
        [166, 165, 164, 163, 162, 161, 160, 153, 152, 151, 150, 149, 148, 147,
         140, 139, 138, 137, 136, 135, 134, 127, 126, 125, 124, 123, 122, 121,
         114, 113, 112, 111, 110, 109, 108, 101, 100,  99,  98,  97,  96,  95,
          88,  87,  86,  85,  84,  83,  82],
        [167, 166, 165, 164, 163, 162, 161, 154, 153, 152, 151, 150, 149, 148,
         141, 140, 139, 138, 137, 136, 135, 128, 127, 126, 125, 124, 123, 122,
         115, 114, 113, 112, 111, 110, 109, 102, 101, 100,  99,  98,  97,  96,
          89,  88,  87,  86,  85,  84,  83],
        [168, 167, 166, 165, 164, 163, 162, 155, 154, 153, 152, 151, 150, 149,
         142, 141, 140, 139, 138, 137, 136, 129, 128, 127, 126, 125, 124, 123,
         116, 115, 114, 113, 112, 111, 110, 103, 102, 101, 100,  99,  98,  97,
          90,  89,  88,  87,  86,  85,  84]])

```

relative_position_index的shape是[49, 49]。这里面最大的值是168，最小的值是0，正好可以对最开始的self.relative_position_bias_table的值全部索引到，self.relative_position_bias_table的shape是[169,4]，169个可索引的位置，4个头。

# 7. forward中的计算

```python
relative_position_bias = self.relative_position_bias_table[self.relative_position_index.view(-1)].view(
    self.window_size[0] * self.window_size[1], self.window_size[0] * self.window_size[1], -1)  # Wh*Ww,Wh*Ww,nH
relative_position_bias = relative_position_bias.permute(2, 0, 1).contiguous()  # nH, Wh*Ww, Wh*Ww
attn = attn + relative_position_bias.unsqueeze(0)
```

将其拆分来看。我们把上面的代码拆分为：

```python
relative_position_index_tmp = self.relative_position_index.view(-1)

relative_position_bias_table_tmp = self.relative_position_bias_table[relative_position_index_tmp]

relative_position_bias = relative_position_bias_table_tmp.view(
    self.window_size[0] * self.window_size[1], self.window_size[0] * self.window_size[1], -1)  # Wh*Ww,Wh*Ww,nH

relative_position_bias = relative_position_bias.permute(2, 0, 1).contiguous()  # nH, Wh*Ww, Wh*Ww

attn = attn + relative_position_bias.unsqueeze(0)
```

* self.relative_position_index.view(-1)操作

上面已经说到relative_position_index的shape是[49, 49]，view(-1)操作会将所有的值放在一个维度，所以假设`relative_position_index_tmp = self.relative_position_index.view(-1)`，relative_position_index_tmp的shape是[2401]，relative_position_index_tmp的值是

```python
tensor([ 84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
         58,  57,  56,  55,  54,  53,  52,  45,  44,  43,  42,  41,  40,  39,
         32,  31,  30,  29,  28,  27,  26,  19,  18,  17,  16,  15,  14,  13,
          6,   5,   4,   3,   2,   1,   0,  85,  84,  83,  82,  81,  80,  79,
         72,  71,  70,  69,  68,  67,  66,  59,  58,  57,  56,  55,  54,  53,
         46,  45,  44,  43,  42,  41,  40,  33,  32,  31,  30,  29,  28,  27,
         20,  19,  18,  17,  16,  15,  14,   7,   6,   5,   4,   3,   2,   1,
         86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
         60,  59,  58,  57,  56,  55,  54,  47,  46,  45,  44,  43,  42,  41,
         34,  33,  32,  31,  30,  29,  28,  21,  20,  19,  18,  17,  16,  15,
          8,   7,   6,   5,   4,   3,   2,  87,  86,  85,  84,  83,  82,  81,
         74,  73,  72,  71,  70,  69,  68,  61,  60,  59,  58,  57,  56,  55,
         48,  47,  46,  45,  44,  43,  42,  35,  34,  33,  32,  31,  30,  29,
         22,  21,  20,  19,  18,  17,  16,   9,   8,   7,   6,   5,   4,   3,
         88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
         62,  61,  60,  59,  58,  57,  56,  49,  48,  47,  46,  45,  44,  43,
         36,  35,  34,  33,  32,  31,  30,  23,  22,  21,  20,  19,  18,  17,
         10,   9,   8,   7,   6,   5,   4,  89,  88,  87,  86,  85,  84,  83,
         76,  75,  74,  73,  72,  71,  70,  63,  62,  61,  60,  59,  58,  57,
         50,  49,  48,  47,  46,  45,  44,  37,  36,  35,  34,  33,  32,  31,
         24,  23,  22,  21,  20,  19,  18,  11,  10,   9,   8,   7,   6,   5,
         90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
         64,  63,  62,  61,  60,  59,  58,  51,  50,  49,  48,  47,  46,  45,
         38,  37,  36,  35,  34,  33,  32,  25,  24,  23,  22,  21,  20,  19,
         12,  11,  10,   9,   8,   7,   6,  97,  96,  95,  94,  93,  92,  91,
         84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
         58,  57,  56,  55,  54,  53,  52,  45,  44,  43,  42,  41,  40,  39,
         32,  31,  30,  29,  28,  27,  26,  19,  18,  17,  16,  15,  14,  13,
         98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
         72,  71,  70,  69,  68,  67,  66,  59,  58,  57,  56,  55,  54,  53,
         46,  45,  44,  43,  42,  41,  40,  33,  32,  31,  30,  29,  28,  27,
         20,  19,  18,  17,  16,  15,  14,  99,  98,  97,  96,  95,  94,  93,
         86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
         60,  59,  58,  57,  56,  55,  54,  47,  46,  45,  44,  43,  42,  41,
         34,  33,  32,  31,  30,  29,  28,  21,  20,  19,  18,  17,  16,  15,
        100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
         74,  73,  72,  71,  70,  69,  68,  61,  60,  59,  58,  57,  56,  55,
         48,  47,  46,  45,  44,  43,  42,  35,  34,  33,  32,  31,  30,  29,
         22,  21,  20,  19,  18,  17,  16, 101, 100,  99,  98,  97,  96,  95,
         88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
         62,  61,  60,  59,  58,  57,  56,  49,  48,  47,  46,  45,  44,  43,
         36,  35,  34,  33,  32,  31,  30,  23,  22,  21,  20,  19,  18,  17,
        102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
         76,  75,  74,  73,  72,  71,  70,  63,  62,  61,  60,  59,  58,  57,
         50,  49,  48,  47,  46,  45,  44,  37,  36,  35,  34,  33,  32,  31,
         24,  23,  22,  21,  20,  19,  18, 103, 102, 101, 100,  99,  98,  97,
         90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
         64,  63,  62,  61,  60,  59,  58,  51,  50,  49,  48,  47,  46,  45,
         38,  37,  36,  35,  34,  33,  32,  25,  24,  23,  22,  21,  20,  19,
        110, 109, 108, 107, 106, 105, 104,  97,  96,  95,  94,  93,  92,  91,
         84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
         58,  57,  56,  55,  54,  53,  52,  45,  44,  43,  42,  41,  40,  39,
         32,  31,  30,  29,  28,  27,  26, 111, 110, 109, 108, 107, 106, 105,
         98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
         72,  71,  70,  69,  68,  67,  66,  59,  58,  57,  56,  55,  54,  53,
         46,  45,  44,  43,  42,  41,  40,  33,  32,  31,  30,  29,  28,  27,
        112, 111, 110, 109, 108, 107, 106,  99,  98,  97,  96,  95,  94,  93,
         86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
         60,  59,  58,  57,  56,  55,  54,  47,  46,  45,  44,  43,  42,  41,
         34,  33,  32,  31,  30,  29,  28, 113, 112, 111, 110, 109, 108, 107,
        100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
         74,  73,  72,  71,  70,  69,  68,  61,  60,  59,  58,  57,  56,  55,
         48,  47,  46,  45,  44,  43,  42,  35,  34,  33,  32,  31,  30,  29,
        114, 113, 112, 111, 110, 109, 108, 101, 100,  99,  98,  97,  96,  95,
         88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
         62,  61,  60,  59,  58,  57,  56,  49,  48,  47,  46,  45,  44,  43,
         36,  35,  34,  33,  32,  31,  30, 115, 114, 113, 112, 111, 110, 109,
        102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
         76,  75,  74,  73,  72,  71,  70,  63,  62,  61,  60,  59,  58,  57,
         50,  49,  48,  47,  46,  45,  44,  37,  36,  35,  34,  33,  32,  31,
        116, 115, 114, 113, 112, 111, 110, 103, 102, 101, 100,  99,  98,  97,
         90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
         64,  63,  62,  61,  60,  59,  58,  51,  50,  49,  48,  47,  46,  45,
         38,  37,  36,  35,  34,  33,  32, 123, 122, 121, 120, 119, 118, 117,
        110, 109, 108, 107, 106, 105, 104,  97,  96,  95,  94,  93,  92,  91,
         84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
         58,  57,  56,  55,  54,  53,  52,  45,  44,  43,  42,  41,  40,  39,
        124, 123, 122, 121, 120, 119, 118, 111, 110, 109, 108, 107, 106, 105,
         98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
         72,  71,  70,  69,  68,  67,  66,  59,  58,  57,  56,  55,  54,  53,
         46,  45,  44,  43,  42,  41,  40, 125, 124, 123, 122, 121, 120, 119,
        112, 111, 110, 109, 108, 107, 106,  99,  98,  97,  96,  95,  94,  93,
         86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
         60,  59,  58,  57,  56,  55,  54,  47,  46,  45,  44,  43,  42,  41,
        126, 125, 124, 123, 122, 121, 120, 113, 112, 111, 110, 109, 108, 107,
        100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
         74,  73,  72,  71,  70,  69,  68,  61,  60,  59,  58,  57,  56,  55,
         48,  47,  46,  45,  44,  43,  42, 127, 126, 125, 124, 123, 122, 121,
        114, 113, 112, 111, 110, 109, 108, 101, 100,  99,  98,  97,  96,  95,
         88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
         62,  61,  60,  59,  58,  57,  56,  49,  48,  47,  46,  45,  44,  43,
        128, 127, 126, 125, 124, 123, 122, 115, 114, 113, 112, 111, 110, 109,
        102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
         76,  75,  74,  73,  72,  71,  70,  63,  62,  61,  60,  59,  58,  57,
         50,  49,  48,  47,  46,  45,  44, 129, 128, 127, 126, 125, 124, 123,
        116, 115, 114, 113, 112, 111, 110, 103, 102, 101, 100,  99,  98,  97,
         90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
         64,  63,  62,  61,  60,  59,  58,  51,  50,  49,  48,  47,  46,  45,
        136, 135, 134, 133, 132, 131, 130, 123, 122, 121, 120, 119, 118, 117,
        110, 109, 108, 107, 106, 105, 104,  97,  96,  95,  94,  93,  92,  91,
         84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
         58,  57,  56,  55,  54,  53,  52, 137, 136, 135, 134, 133, 132, 131,
        124, 123, 122, 121, 120, 119, 118, 111, 110, 109, 108, 107, 106, 105,
         98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
         72,  71,  70,  69,  68,  67,  66,  59,  58,  57,  56,  55,  54,  53,
        138, 137, 136, 135, 134, 133, 132, 125, 124, 123, 122, 121, 120, 119,
        112, 111, 110, 109, 108, 107, 106,  99,  98,  97,  96,  95,  94,  93,
         86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
         60,  59,  58,  57,  56,  55,  54, 139, 138, 137, 136, 135, 134, 133,
        126, 125, 124, 123, 122, 121, 120, 113, 112, 111, 110, 109, 108, 107,
        100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
         74,  73,  72,  71,  70,  69,  68,  61,  60,  59,  58,  57,  56,  55,
        140, 139, 138, 137, 136, 135, 134, 127, 126, 125, 124, 123, 122, 121,
        114, 113, 112, 111, 110, 109, 108, 101, 100,  99,  98,  97,  96,  95,
         88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
         62,  61,  60,  59,  58,  57,  56, 141, 140, 139, 138, 137, 136, 135,
        128, 127, 126, 125, 124, 123, 122, 115, 114, 113, 112, 111, 110, 109,
        102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
         76,  75,  74,  73,  72,  71,  70,  63,  62,  61,  60,  59,  58,  57,
        142, 141, 140, 139, 138, 137, 136, 129, 128, 127, 126, 125, 124, 123,
        116, 115, 114, 113, 112, 111, 110, 103, 102, 101, 100,  99,  98,  97,
         90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
         64,  63,  62,  61,  60,  59,  58, 149, 148, 147, 146, 145, 144, 143,
        136, 135, 134, 133, 132, 131, 130, 123, 122, 121, 120, 119, 118, 117,
        110, 109, 108, 107, 106, 105, 104,  97,  96,  95,  94,  93,  92,  91,
         84,  83,  82,  81,  80,  79,  78,  71,  70,  69,  68,  67,  66,  65,
        150, 149, 148, 147, 146, 145, 144, 137, 136, 135, 134, 133, 132, 131,
        124, 123, 122, 121, 120, 119, 118, 111, 110, 109, 108, 107, 106, 105,
         98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
         72,  71,  70,  69,  68,  67,  66, 151, 150, 149, 148, 147, 146, 145,
        138, 137, 136, 135, 134, 133, 132, 125, 124, 123, 122, 121, 120, 119,
        112, 111, 110, 109, 108, 107, 106,  99,  98,  97,  96,  95,  94,  93,
         86,  85,  84,  83,  82,  81,  80,  73,  72,  71,  70,  69,  68,  67,
        152, 151, 150, 149, 148, 147, 146, 139, 138, 137, 136, 135, 134, 133,
        126, 125, 124, 123, 122, 121, 120, 113, 112, 111, 110, 109, 108, 107,
        100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
         74,  73,  72,  71,  70,  69,  68, 153, 152, 151, 150, 149, 148, 147,
        140, 139, 138, 137, 136, 135, 134, 127, 126, 125, 124, 123, 122, 121,
        114, 113, 112, 111, 110, 109, 108, 101, 100,  99,  98,  97,  96,  95,
         88,  87,  86,  85,  84,  83,  82,  75,  74,  73,  72,  71,  70,  69,
        154, 153, 152, 151, 150, 149, 148, 141, 140, 139, 138, 137, 136, 135,
        128, 127, 126, 125, 124, 123, 122, 115, 114, 113, 112, 111, 110, 109,
        102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
         76,  75,  74,  73,  72,  71,  70, 155, 154, 153, 152, 151, 150, 149,
        142, 141, 140, 139, 138, 137, 136, 129, 128, 127, 126, 125, 124, 123,
        116, 115, 114, 113, 112, 111, 110, 103, 102, 101, 100,  99,  98,  97,
         90,  89,  88,  87,  86,  85,  84,  77,  76,  75,  74,  73,  72,  71,
        162, 161, 160, 159, 158, 157, 156, 149, 148, 147, 146, 145, 144, 143,
        136, 135, 134, 133, 132, 131, 130, 123, 122, 121, 120, 119, 118, 117,
        110, 109, 108, 107, 106, 105, 104,  97,  96,  95,  94,  93,  92,  91,
         84,  83,  82,  81,  80,  79,  78, 163, 162, 161, 160, 159, 158, 157,
        150, 149, 148, 147, 146, 145, 144, 137, 136, 135, 134, 133, 132, 131,
        124, 123, 122, 121, 120, 119, 118, 111, 110, 109, 108, 107, 106, 105,
         98,  97,  96,  95,  94,  93,  92,  85,  84,  83,  82,  81,  80,  79,
        164, 163, 162, 161, 160, 159, 158, 151, 150, 149, 148, 147, 146, 145,
        138, 137, 136, 135, 134, 133, 132, 125, 124, 123, 122, 121, 120, 119,
        112, 111, 110, 109, 108, 107, 106,  99,  98,  97,  96,  95,  94,  93,
         86,  85,  84,  83,  82,  81,  80, 165, 164, 163, 162, 161, 160, 159,
        152, 151, 150, 149, 148, 147, 146, 139, 138, 137, 136, 135, 134, 133,
        126, 125, 124, 123, 122, 121, 120, 113, 112, 111, 110, 109, 108, 107,
        100,  99,  98,  97,  96,  95,  94,  87,  86,  85,  84,  83,  82,  81,
        166, 165, 164, 163, 162, 161, 160, 153, 152, 151, 150, 149, 148, 147,
        140, 139, 138, 137, 136, 135, 134, 127, 126, 125, 124, 123, 122, 121,
        114, 113, 112, 111, 110, 109, 108, 101, 100,  99,  98,  97,  96,  95,
         88,  87,  86,  85,  84,  83,  82, 167, 166, 165, 164, 163, 162, 161,
        154, 153, 152, 151, 150, 149, 148, 141, 140, 139, 138, 137, 136, 135,
        128, 127, 126, 125, 124, 123, 122, 115, 114, 113, 112, 111, 110, 109,
        102, 101, 100,  99,  98,  97,  96,  89,  88,  87,  86,  85,  84,  83,
        168, 167, 166, 165, 164, 163, 162, 155, 154, 153, 152, 151, 150, 149,
        142, 141, 140, 139, 138, 137, 136, 129, 128, 127, 126, 125, 124, 123,
        116, 115, 114, 113, 112, 111, 110, 103, 102, 101, 100,  99,  98,  97,
         90,  89,  88,  87,  86,  85,  84], device='cuda:0')
```

* self.relative_position_bias_table[relative_position_index_tmp]操作

上面说到，self.relative_position_bias_table的shape是[169,4]，在上面也有打印它的值。relative_position_index_tmp的shape是[2401]的索引值，所以此步操作就相当于对self.relative_position_bias_table做2401次索引，每次索引出来的都是shape为[1,4]的tensor，所以
`relative_position_bias_table_tmp = self.relative_position_bias_table[relative_position_index_tmp]`后，relative_position_bias_table_tmp的shape为[2401, 4],他的部分值展示如下：
```python
tensor([[-2.7874e-02, -3.6342e-02,  2.8827e-02, -2.3673e-02],
        [ 4.1464e-02,  7.6075e-03,  5.3314e-03, -1.4585e-03],
        [-1.4711e-02, -1.3424e-02, -1.3756e-03, -1.3826e-03],
        [-3.6255e-02, -1.9680e-03,  1.6092e-02,  2.3690e-02],
        ...
       [-2.0880e-02, -1.2093e-02,  4.1462e-02,  1.8901e-02],
        [-1.6958e-02, -6.0754e-03, -1.3342e-02, -7.5932e-04],
        [ 8.9761e-03, -1.1548e-02, -2.5437e-02,  1.5095e-02],
        [-2.7874e-02, -3.6342e-02,  2.8827e-02, -2.3673e-02]]
```

*  relative_position_bias_table_tmp.view(self.window_size[0] * self.window_size[1],self.window_size[0] * self.window_size[1], -1)操作

这一步就是将之前的view(-1)操作再转换回原始尺寸。所以`relative_position_bias = relative_position_bias_table_tmp.view(self.window_size[0] * self.window_size[1], self.window_size[0] * self.window_size[1], -1)`，relative_position_bias的shape是[49, 49, 4].

* relative_position_bias.permute(2, 0, 1).contiguous()操作

上一步relative_position_bias的shape是[49, 49, 4]，经过permute操作后，shape变为[4, 49, 49].

`attn = attn + relative_position_bias.unsqueeze(0)`，attn经过attention计算后，shape是([6400, 4, 49, 49])，这里的relative_position_bias经过unsqueeze一下，正好可以和attn的结果相加。

